### 由于docker搭建的galera-mysql，删除其中1个docker,导致另外正常的docker不能正常工作.

现在vm上测试，发现问题。

###正式环境下，请先备份好数据库，不然会让你流泪的。

node1:

	ip:192.168.122.138
	user:root
	passwd:12345678

node2:

	ip:192.168.122.139
	user:root
	passwd:123456


### 在node1上启动：

nodea:

	docker run -d -p 4306:3306 -p 5567:5567 -p 5444:5444 -p 5568:5568  -e MYSQL_ROOT_PASSWORD=123456  --name nodea erkules/galera:latest --wsrep-cluster-address=gcomm:// --wsrep-node-address=192.168.122.138:5567 --wsrep-sst-receive-address=192.168.122.138:5444 --wsrep-provider-options="ist.recv_addr=192.168.122.138:5568"


### node2上启动：

	cat /etc/passwd 可以查看所有用户的列表
	w 可以查看当前活跃的用户列表
	cat /etc/group 查看用户组

创建目录：

	mkdir -p /mnt2/mysql-data
	chmod -R 775 /mnt2/mysql-data

nodeb:

	docker run -d -p 4306:3306 -p 5567:5567 -p 5444:5444 -p 5568:5568 -e MYSQL_ROOT_PASSWORD=123456  --name nodeb erkules/galera:latest --wsrep-cluster-address=gcomm://192.168.122.138:5567 --wsrep-node-address=192.168.122.139:5567 --wsrep-sst-receive-address=192.168.122.139:5444 --wsrep-provider-options="ist.recv_addr=192.168.122.139:5568"



nodec数据持久化：

	docker run -d -p 4307:3306 -p 5570:5570 -p 5445:5445 -p 5571:5571 -v /mnt2/mysql-data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name nodec erkules/galera:latest --wsrep-cluster-address=gcomm://192.168.122.139:5567 --wsrep-node-address=192.168.122.139:5570 --wsrep-sst-receive-address=192.168.122.139:5445 --wsrep_provider_options="base_port=5570;" --wsrep-provider-options="ist.recv_addr=192.168.122.139:5571"

### 查询集群节点数

	show global status like 'wsrep_cluster_size';

问题汇总：

A：mysql FATAL ERROR: Could not chown directory /var/lib/mysql//mysql 或 报“Permission denied”

Q:


	可通过三种方式解决：
	
	1> 关闭selinux。
	
	临时关闭：# setenforce 0 
	或：su -c "setenforce 0"
	重新开启：su -c "setenforce 1"
	
	永久关闭：修改/etc/sysconfig/selinux文件，将SELINUX的值设置为disabled。
	
	2> 以特权方式启动容器 
	
	指定--privileged参数
	
	如：# docker run -it --privileged=true -v /test:/soft centos /bin/bash

	3，添加selinux规则，将要挂载的目录添加到白名单：
	
	示例：chcon -Rt svirt_sandbox_file_t /home/docs
	
	之后执行：docker run -i -t -v /home/docs:/src waterchestnut/nodejs:0.12.0

[https://stackoverflow.com/questions/24288616/permission-denied-on-accessing-host-directory-in-docker](https://stackoverflow.com/questions/24288616/permission-denied-on-accessing-host-directory-in-docker)



A1:ERROR 1047 (08S01): WSREP has not yet prepared node for application use 

Q1:这种情况一般发生在2台服务器，其中一台服务器挂掉的，整个集群就死掉的情况。

	SET GLOBAL wsrep_provider_options='pc.bootstrap=YES';

这个方法，我们可以告诉节点,你可以单独组成一个集群。

[http://galeracluster.com/documentation-webpages/twonode.html](http://galeracluster.com/documentation-webpages/twonode.html)

https://stackoverflow.com/questions/40653238/mariadb-galera-error-when-a-node-shutdown-error-1047-wsrep-has-not-yet-prepare

[http://blog.csdn.net/zengxuewen2045/article/details/51868976](http://blog.csdn.net/zengxuewen2045/article/details/51868976)